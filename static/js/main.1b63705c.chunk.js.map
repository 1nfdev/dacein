{"version":3,"sources":["editor.js","errors.js","inspector.js","sketch-container.js","sketch.js","hooks.js","optimise.js","overlay.js","help.js","topbar.js","index.js","commands.js","panel.js","ast-transforms.js","examples.js","slider.js","math.js","app.js"],"names":["getColorFormat","str","RE_HSL","RegExp","RE_RGB","RE_HEX","match","NumberPicker","_ref","value","coords","onChange","_useState","useState","_useState2","Object","_Users_szymon_Documents_Projects_Dacein_Code_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","draftValue","setDraftValue","exp","Math","round","log10","abs","max","pow","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","className","style","top","left","zIndex","width","_slider__WEBPACK_IMPORTED_MODULE_8__","position","scale","out","concat","ColorPicker","_ref2","_useState3","replace","_useState4","format","react_color__WEBPACK_IMPORTED_MODULE_3__","color","e","v","hex","hsl","h","s","l","rgb","r","g","b","stringifyColorFormat","Picker","_ref3","type","Editor","_ref4","code","highlight","_useState5","_useState6","picker","setPicker","_useState7","_useState8","editorCode","setEditorCode","instance","useRef","tokenLength","highlightMarker","useEffect","current","clearMarker","clear","markText","line","start","end","react_codemirror2__WEBPACK_IMPORTED_MODULE_4__","editorDidMount","onBeforeChange","editor","data","onCursor","cursor","getCursor","token","getTokenAt","charCoords","ch","string","length","key","Number","text","options","theme","react_outside_click_handler__WEBPACK_IMPORTED_MODULE_1___default","onOutsideClick","_picker$text","newCode","split","map","codeLine","i","substr","join","__webpack_require__","d","__webpack_exports__","Errors","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","lodash__WEBPACK_IMPORTED_MODULE_1__","errors","filter","identity","encodeInColor","num","toString","leftPad","makeInspector","sketch","globals","canvas","document","height","memo","ctx","getContext","draw","state","constants","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","operation","_operation","slicedToArray","command","args","argsModded","assign","fill","stroke","COMMANDS","err","return","onHover","x","y","getImageData","slice","parseInt","decodeFromColor","Array","from","getMetaForId","id","get","MAX_HISTORY_LEN","SketchContainer","_React$Component","_getPrototypeOf2","_this","classCallCheck","this","_len","arguments","_args","_key","possibleConstructorReturn","getPrototypeOf","call","apply","setupCanvas","props","ref","events","makeOnMouse","bbox","getBoundingClientRect","push","source","pos","clientX","clientY","onMouseMove","onMouseDown","onMouseUp","onMouseClick","onKeyDown","ctrlKey","shiftKey","altKey","metaKey","onKeyUp","addEventListener","removeCanvasEvents","removeEventListener","resetCanvas","resetState","currentState","cloneDeep","initialState","setHistory","draft","stateHistory","eventsHistory","idx","setupInspector","isPlaying","inspector","onMouseDownInspector","console","warning","floor","mx","my","_this$inspector$getMe","_this$inspector$getMe2","optimiseArgs","delta","target","setOptimiser","onMouseUpInspector","onMouseMoveInspector","optimiser","objectSpread","metaForId","meta","__meta","setHighlight","lineStart","lineEnd","onMouseOutInspector","window","removeInspector","resetInspector","runExecute","toExecute","size","forEach","Set","tick","frame","requestAnimationFrame","bind","assertThisInitialized","_this$props","immer","update","shift","min","inherits","createClass","debounce","cancelAnimationFrame","nextProps","xor","keys","add","historyIdx","currentEvents","_this2","react_default","React","Component","RoundButton","onClick","children","fontSize","SketchControls","setIsPlaying","onReset","sketch_RoundButton","slider","disabled","clamp","Sketch","setConstants","_useImmer","initialValue","val","updateValue","updater","useImmer","_useImmer2","_useImmer2$","_get","_get2","newConstants","minimised","x0","uncmin","drawCalls","dist","warn","solution","optimise","panel","direction","DIRECTION","VERTICAL","defaultDivide","sketch_SketchControls","sketch_container_SketchContainer","main_default","src","name","enableClipboard","displayDataTypes","displayObjectSize","indentWidth","collapsed","Overlay","onClose","_useWindowSize","useWindowSize","innerWidth","innerHeight","Fragment","background","A","href","LANG_HELP","Help","overlay_Overlay","help_A","listStyle","arg","Topbar","setCode","isHelpVisible","setHelpVisible","isExamplesMenuVisible","setExamplesMenuVisible","fileRef","marginBottom","click","saveAs","Blob","entries","EXAMPLES","exampleCode","file","files","reader","FileReader","onload","content","result","readAsText","help_Help","react_dom__WEBPACK_IMPORTED_MODULE_1__","react_dom__WEBPACK_IMPORTED_MODULE_1___default","_app__WEBPACK_IMPORTED_MODULE_2__","ReactDOM","render","getElementById","fillStyle","fillRect","strokeStyle","beginPath","moveTo","lineTo","path","points","point","ellipse","_ref5","_ref6","_ref7","_ref8","_ref9","w","PI","rect","_ref10","_ref11","_ref12","_ref13","_ref14","HORIZONTAL","Panel","_ref$direction","_ref$defaultDivide","useComponentSize","isDragging","setIsDragging","divider","setDivider","preventDefault","styles","dividerSize","handleWrapperStyle","handleStyle","marginLeft","marginTop","wrapperClassName","react__WEBPACK_IMPORTED_MODULE_1___default","Builders","recast","types","builders","addMeta","ast","parse","visit","visitExpressionStatement","traverse","visitProperty","visitReturnStatement","visitArrayExpression","elements","maybeCommand","loc","searchPath","arrayExpression","objectExpression","_Users_szymon_Documents_Projects_Dacein_Code_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__","properties","property","identifier","literal","print","processRequire","requires","visitIdentifier","parentPath","codeWithoutRequire","some","replaceConstants","visitLiteral","isNumber","isInsideDraw","number","raw","pullOutConstants","pulledConstants","visitArrowFunctionExpression","arrowFunctionExpression","body","visitFunctionExpression","functionExpression","memberExpression","animated rectangle","brownian motion","particle system","spring","Slider","_ref$disabled","_ref$position","_ref$onChange","_ref$height","inputMin","inputMax","outputMin","outputMax","ax","ay","bx","by","hypot","App","_Users_szymon_Documents_Projects_Dacein_Code_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","setSketch","setErrors","_useState9","_useState10","tmpErrors","finalCode","require","requireFrom","Promise","resolve","description","_Users_szymon_Documents_Projects_Dacein_Code_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","_pullOutConstants","codeWithoutConstants","pulledOutConstants","codeWithMeta","codeWithRequires","eval","_topbar__WEBPACK_IMPORTED_MODULE_9__","_panel__WEBPACK_IMPORTED_MODULE_7__","_sketch__WEBPACK_IMPORTED_MODULE_8__","_editor__WEBPACK_IMPORTED_MODULE_5__","_errors__WEBPACK_IMPORTED_MODULE_6__"],"mappings":"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","file":"static/js/main.1b63705c.chunk.js","sourcesContent":["import OutsideClickHandler from \"react-outside-click-handler\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { ChromePicker } from \"react-color\";\nimport { Controlled as CodeMirror } from \"react-codemirror2\";\n\nimport \"codemirror/lib/codemirror.css\";\nimport \"codemirror/mode/javascript/javascript\";\n\nimport \"./codemirror-base16-grayscale-dark.css\";\nimport { Slider } from \"./slider\";\nimport { scale } from \"./math\";\n\nconst getColorFormat = str => {\n  const RE_HSL = new RegExp(\n    /hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}%)\\s*,\\s*(\\d{1,3}%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)/g\n  );\n  const RE_RGB = new RegExp(/rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)/g);\n  const RE_HEX = new RegExp(/#[a-fA-F0-9]{3,6}/g);\n\n  if (str.match(RE_HSL)) {\n    return \"hsl\";\n  }\n\n  if (str.match(RE_RGB)) {\n    return \"rgb\";\n  }\n\n  if (str.match(RE_HEX)) {\n    return \"hex\";\n  }\n\n  return null;\n};\n\nconst stringifyColorFormat = (v, format) => {\n  if (format === \"hex\") {\n    return `\"${v.hex}\"`;\n  }\n\n  if (format === \"hsl\") {\n    return `\"hsl(${v.hsl.h}, ${v.hsl.s}, ${v.hsl.l}, ${v.hsl.a})\"`;\n  }\n\n  if (format === \"rgb\") {\n    return `\"rgb(${v.rgb.r}, ${v.rgb.g}, ${v.rgb.b}, ${v.rgb.a})\"`;\n  }\n\n  return null;\n};\n\nconst NumberPicker = ({ value, coords, onChange }) => {\n  const [draftValue, setDraftValue] = useState(value);\n\n  const exp = Math.round(Math.log10(Math.abs(value)));\n  const min = 0;\n  const max = Math.pow(10, exp + 1);\n\n  return (\n    <div\n      className=\"absolute\"\n      style={{\n        top: coords.top > 30 ? coords.top - 12 : coords.top + 16,\n        left: coords.left - 10,\n        zIndex: 10,\n        width: 120\n      }}\n    >\n      <Slider\n        position={scale(draftValue, min, max, 0, 1)}\n        onChange={value => {\n          const out = scale(value, 0, 1, min, max);\n          setDraftValue(out);\n          onChange(`${out}`);\n        }}\n      />\n    </div>\n  );\n};\n\nconst ColorPicker = ({ value, coords, onChange }) => {\n  const [draftValue, setDraftValue] = useState(value.replace(/\"/g, \"\"));\n\n  const format = getColorFormat(value);\n\n  return (\n    <div\n      className=\"absolute bg-light-gray br3\"\n      style={{\n        top: coords.top > 300 ? coords.top - 250 : coords.top + 20,\n        left: coords.left - 40,\n        zIndex: 10\n      }}\n    >\n      <ChromePicker\n        color={draftValue}\n        onChange={e => {\n          setDraftValue(e[format]);\n          onChange(stringifyColorFormat(e, format));\n        }}\n      />\n    </div>\n  );\n};\n\nconst Picker = ({ type, coords, value, onChange }) => {\n  if (type === \"number\") {\n    return <NumberPicker value={value} coords={coords} onChange={onChange} />;\n  }\n\n  if (getColorFormat(value) !== null) {\n    return <ColorPicker value={value} coords={coords} onChange={onChange} />;\n  }\n\n  return null;\n};\n\nexport const Editor = ({ code, highlight, onChange }) => {\n  const [picker, setPicker] = useState(null);\n  const [editorCode, setEditorCode] = useState(null);\n\n  const instance = useRef(null);\n  const tokenLength = useRef(null);\n  const highlightMarker = useRef(null);\n\n  // FIXME\n  useEffect(() => {\n    if (code !== editorCode) {\n      setEditorCode(code);\n    }\n  }, [code]);\n\n  useEffect(() => {\n    if (!instance.current) {\n      return;\n    }\n\n    const clearMarker = () => {\n      if (highlightMarker.current) {\n        highlightMarker.current.clear();\n        highlightMarker.current = null;\n      }\n    };\n\n    clearMarker();\n\n    if (highlight) {\n      highlightMarker.current = instance.current.markText(\n        { line: highlight.start },\n        { line: highlight.end },\n        { className: \"inspector-highlight\" }\n      );\n    }\n\n    return clearMarker;\n  }, [instance, highlight]);\n\n  return (\n    <div className=\"relative h-100 overflow-scroll\">\n      <CodeMirror\n        editorDidMount={e => (instance.current = e)}\n        value={editorCode}\n        onBeforeChange={(editor, data, value) => setEditorCode(value)}\n        onChange={(editor, data, value) => onChange(value)}\n        onCursor={e => {\n          const cursor = e.getCursor();\n          const token = e.getTokenAt(cursor);\n          const coords = e.charCoords(\n            { line: cursor.line, ch: token.start },\n            \"local\"\n          );\n\n          if (!token.type) {\n            return;\n          }\n\n          tokenLength.current = token.string.length;\n\n          setPicker({\n            key: `${token.type}-${token.string}`,\n            type: token.type,\n            value:\n              token.type === \"number\" ? Number(token.string) : token.string,\n            coords,\n            text: {\n              line: cursor.line,\n              start: token.start\n            }\n          });\n        }}\n        options={{\n          theme: \"base16-grayscale-dark\"\n        }}\n      />\n\n      {picker && (\n        <OutsideClickHandler onOutsideClick={() => setPicker(null)}>\n          <Picker\n            key={picker.key}\n            type={picker.type}\n            coords={picker.coords}\n            value={picker.value}\n            onChange={value => {\n              const { start, line } = picker.text;\n\n              const newCode = editorCode\n                .split(\"\\n\")\n                .map((codeLine, i) => {\n                  if (i !== line) {\n                    return codeLine;\n                  }\n\n                  return (\n                    codeLine.substr(0, start) +\n                    value +\n                    codeLine.substr(start + tokenLength.current)\n                  );\n                })\n                .join(\"\\n\");\n\n              tokenLength.current = `${value}`.length;\n              setEditorCode(newCode);\n            }}\n          />\n        </OutsideClickHandler>\n      )}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { identity } from \"lodash\";\n\nexport const Errors = ({ errors }) => {\n  return (\n    <div className=\"pa2 f7\">\n      {!errors || (!errors.length && <div className=\"gray\">no errors</div>)}\n\n      {(errors || []).filter(identity).map(text => (\n        <div className=\"red\" key={text}>\n          {text}\n        </div>\n      ))}\n    </div>\n  );\n};\n","import leftPad from \"left-pad\";\nimport { get } from \"lodash\";\n\nimport { COMMANDS } from \"./commands\";\n\nconst encodeInColor = num => {\n  const hex = num.toString(16).substr(0, 6);\n  return `#${leftPad(hex, 6, \"0\")}`;\n};\n\nconst decodeFromColor = hex => {\n  return parseInt(`0x${hex}`);\n};\n\nexport const makeInspector = ({ sketch, globals }) => {\n  const canvas = document.createElement(\"canvas\");\n\n  canvas.width = globals.width;\n  canvas.height = globals.height;\n\n  const ctx = canvas.getContext(\"2d\");\n\n  let memo;\n\n  const draw = (state, constants) => {\n    let i = 0;\n\n    memo = sketch.draw(state, constants);\n\n    for (const operation of memo) {\n      const [command, args] = operation;\n\n      const argsModded = Object.assign(args, {\n        fill: args.fill ? encodeInColor(i) : undefined,\n        stroke: args.stroke ? encodeInColor(i) : undefined\n      });\n\n      if (COMMANDS[command]) {\n        COMMANDS[command](ctx, argsModded, globals);\n      }\n\n      i++;\n    }\n  };\n\n  const onHover = (x, y) => {\n    const data = ctx.getImageData(x, y, 1, 1).data.slice(0, 3);\n    const hex = Array.from(data)\n      .map(n => leftPad(n.toString(16), 2, \"0\"))\n      .join(\"\");\n    const id = decodeFromColor(hex);\n\n    return id;\n  };\n\n  const getMetaForId = id => get(memo, id);\n\n  return {\n    draw,\n    onHover,\n    getMetaForId\n  };\n};\n","import React from \"react\";\nimport immer from \"immer\";\nimport { cloneDeep, xor, debounce } from \"lodash\";\n\nimport { COMMANDS } from \"./commands\";\nimport { makeInspector } from \"./inspector\";\n\nconst MAX_HISTORY_LEN = 1000;\n\nexport class SketchContainer extends React.Component {\n  setupCanvas = props => {\n    this.ref.width = (props || this.props).width;\n    this.ref.height = (props || this.props).height;\n\n    this.events = [];\n\n    const makeOnMouse = type => e => {\n      const bbox = this.ref.getBoundingClientRect();\n\n      this.events.push({\n        source: type,\n        pos: [e.clientX - bbox.left, e.clientY - bbox.top]\n      });\n    };\n\n    this.onMouseMove = makeOnMouse(\"mousemove\");\n    this.onMouseDown = makeOnMouse(\"mousedown\");\n    this.onMouseUp = makeOnMouse(\"mouseup\");\n    this.onMouseClick = makeOnMouse(\"mouseclick\");\n\n    this.onKeyDown = e => {\n      this.events.push({\n        source: \"keydown\",\n        key: e.key,\n        code: e.code,\n        ctrlKey: e.ctrlKey,\n        shiftKey: e.shiftKey,\n        altKey: e.altKey,\n        metaKey: e.metaKey\n      });\n    };\n\n    this.onKeyUp = e => {\n      this.events.push({\n        source: \"keydown\",\n        key: e.key,\n        code: e.code,\n        ctrlKey: e.ctrlKey,\n        shiftKey: e.shiftKey,\n        altKey: e.altKey,\n        metaKey: e.metaKey\n      });\n    };\n\n    this.ref.addEventListener(\"mousemove\", this.onMouseMove);\n    this.ref.addEventListener(\"mousedown\", this.onMouseDown);\n    this.ref.addEventListener(\"mouseup\", this.onMouseUp);\n    this.ref.addEventListener(\"click\", this.onMouseClick);\n    this.ref.addEventListener(\"keydown\", this.onKeyDown);\n    this.ref.addEventListener(\"keyup\", this.onKeyUp);\n  };\n\n  removeCanvasEvents = () => {\n    this.ref.removeEventListener(\"mousemove\", this.onMouseMove);\n    this.ref.removeEventListener(\"mousedown\", this.onMouseDown);\n    this.ref.removeEventListener(\"mouseup\", this.onMouseUp);\n    this.ref.removeEventListener(\"click\", this.onMouseClick);\n    this.ref.removeEventListener(\"keydown\", this.onKeyDown);\n    this.ref.removeEventListener(\"keyup\", this.onKeyUp);\n  };\n\n  resetCanvas = () => {\n    this.removeCanvasEvents();\n    this.setupCanvas();\n  };\n\n  resetState = props => {\n    this.currentState = cloneDeep((props || this.props).sketch.initialState);\n\n    this.props.setHistory(draft => {\n      draft.stateHistory = [this.currentState];\n      draft.eventsHistory = [[]];\n\n      draft.idx = 0;\n    });\n  };\n\n  setupInspector = props => {\n    if (this.props.isPlaying) {\n      return;\n    }\n\n    this.inspector = makeInspector(props || this.props);\n\n    this.onMouseDownInspector = e => {\n      if (this.props.isPlaying) {\n        console.warning(\"onMouseDownInspector while playing!\");\n      }\n\n      const bbox = this.ref.getBoundingClientRect();\n\n      const [mx, my] = [\n        Math.floor(e.clientX - bbox.left),\n        Math.floor(e.clientY - bbox.top)\n      ];\n\n      const id = this.inspector.onHover(mx, my);\n      const [command, args] = this.inspector.getMetaForId(id);\n      const delta = args.pos ? [mx - args.pos[0], my - args.pos[1]] : [0, 0];\n\n      const optimiseArgs = {\n        id,\n        command,\n        args,\n        delta,\n        target: [mx, my]\n      };\n\n      this.props.setOptimiser(optimiseArgs);\n    };\n\n    this.onMouseUpInspector = () => {\n      if (this.props.isPlaying) {\n        console.warning(\"onMouseUpInspector while playing!\");\n      }\n\n      this.props.setOptimiser(false);\n    };\n\n    this.onMouseMoveInspector = e => {\n      if (this.props.isPlaying) {\n        console.warning(\"onMouseMoveInspector while playing!\");\n      }\n\n      const bbox = this.ref.getBoundingClientRect();\n\n      const [mx, my] = [\n        Math.floor(e.clientX - bbox.left),\n        Math.floor(e.clientY - bbox.top)\n      ];\n\n      if (this.props.optimiser) {\n        this.props.setOptimiser({ ...this.props.optimiser, target: [mx, my] });\n      } else {\n        const id = this.inspector.onHover(mx, my);\n        const metaForId = this.inspector.getMetaForId(id);\n\n        if (!metaForId || metaForId.length <= 1) {\n          return;\n        }\n\n        const args = metaForId[1];\n        const meta = args.__meta;\n\n        this.props.setHighlight(\n          meta ? { start: meta.lineStart - 2, end: meta.lineEnd - 1 } : null\n        );\n      }\n    };\n\n    this.onMouseOutInspector = () => this.props.setHighlight(null);\n\n    this.ref.addEventListener(\"mousemove\", this.onMouseMoveInspector);\n    this.ref.addEventListener(\"mousedown\", this.onMouseDownInspector);\n    this.ref.addEventListener(\"mouseout\", this.onMouseOutInspector);\n\n    window.addEventListener(\"mouseup\", this.onMouseUpInspector);\n  };\n\n  removeInspector = () => {\n    this.ref.removeEventListener(\"mousemove\", this.onMouseMoveInspector);\n    this.ref.removeEventListener(\"mousedown\", this.onMouseDownInspector);\n    this.ref.removeEventListener(\"mouseout\", this.onMouseOutInspector);\n\n    window.removeEventListener(\"mouseup\", this.onMouseUpInspector);\n\n    this.inspector = undefined;\n  };\n\n  resetInspector = () => {\n    this.removeInspector();\n    this.setupInspector();\n  };\n\n  runExecute = () => {\n    if (this.toExecute.size === 0) {\n      return;\n    }\n\n    if (this.toExecute.size > 0) {\n      this.toExecute.forEach(key => this[key]());\n      this.toExecute = new Set();\n    }\n  };\n\n  tick = () => {\n    if (this.toExecute.size > 0) {\n      this.frame = requestAnimationFrame(this.tick.bind(this));\n      return;\n    }\n\n    const { sketch, constants, globals, setHistory, isPlaying } = this.props;\n\n    const ctx = this.ref.getContext(\"2d\");\n\n    if (isPlaying) {\n      this.currentState = immer(this.currentState, draft =>\n        sketch.update(draft, this.events)\n      );\n\n      setHistory(draft => {\n        draft.stateHistory.push(this.currentState);\n        draft.eventsHistory.push(this.events);\n\n        while (draft.stateHistory.length > MAX_HISTORY_LEN + 1) {\n          draft.stateHistory.shift();\n          draft.eventsHistory.shift();\n        }\n\n        draft.idx = Math.min(MAX_HISTORY_LEN, draft.idx + 1);\n      });\n    }\n\n    if (this.inspector) {\n      this.inspector.draw(this.currentState, constants);\n    }\n\n    for (const operation of sketch.draw(this.currentState, constants)) {\n      const [command, args] = operation;\n\n      if (COMMANDS[command]) {\n        COMMANDS[command](ctx, args, globals);\n      }\n    }\n\n    this.events = [];\n\n    this.frame = requestAnimationFrame(this.tick.bind(this));\n  };\n\n  componentDidMount() {\n    this.toExecute = new Set();\n    this.runExecute = debounce(this.runExecute, 16);\n\n    this.setupCanvas(this.props);\n    this.resetState(this.props);\n\n    this.frame = requestAnimationFrame(this.tick);\n  }\n\n  componentWillUmount() {\n    if (this.frame) {\n      cancelAnimationFrame(this.frame);\n    }\n\n    this.removeCanvasEvents();\n    this.removeInspector();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      xor(\n        Object.keys(nextProps.sketch.initialState),\n        Object.keys(this.currentState)\n      ).length > 0\n    ) {\n      this.toExecute.add(\"resetState\");\n      this.toExecute.add(\"resetInspector\");\n    }\n\n    if (\n      nextProps.width !== this.props.width ||\n      nextProps.height !== this.props.height\n    ) {\n      this.toExecute.add(\"resetCanvas\");\n      this.toExecute.add(\"resetInspector\");\n    }\n\n    if (\n      nextProps.historyIdx !== this.props.historyIdx &&\n      !nextProps.isPlaying\n    ) {\n      this.currentState = nextProps.stateHistory[nextProps.historyIdx];\n      this.currentEvents = nextProps.eventsHistory[nextProps.historyIdx];\n    }\n\n    if (nextProps.isPlaying && !this.props.isPlaying) {\n      this.toExecute.add(\"removeInspector\");\n    }\n\n    if (!nextProps.isPlaying && this.props.isPlaying) {\n      this.toExecute.add(\"resetInspector\");\n    }\n\n    this.runExecute();\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  render() {\n    return <canvas ref={ref => (this.ref = ref)} />;\n  }\n}\n","import JSON from \"react-json-view\";\nimport React, { useEffect, useState } from \"react\";\nimport { get } from \"lodash\";\n\nimport { Panel, DIRECTION } from \"./panel\";\nimport { SketchContainer } from \"./sketch-container\";\nimport { Slider } from \"./slider\";\nimport { clamp } from \"./math\";\nimport { optimise } from \"./optimise\";\nimport { useImmer } from \"./hooks\";\n\nconst DEFAULT_IS_PLAYING = true;\n\nconst RoundButton = ({ onClick, children }) => (\n  <div className=\"dib\">\n    <button\n      className=\"mr2 custom-dark bg-gray br-pill bn lh-solid dt dim pointer\"\n      style={{ height: 26, width: 26 }}\n      onClick={onClick}\n    >\n      <div className=\"dtc v-mid tc\" style={{ fontSize: 12, width: 26 }}>\n        {children}\n      </div>\n    </button>\n  </div>\n);\n\nconst SketchControls = ({\n  isPlaying,\n  historyIdx,\n  stateHistory,\n  setIsPlaying,\n  setHistory,\n  onReset\n}) => (\n  <div className=\"pa2 flex items-center\">\n    <RoundButton\n      onClick={() => {\n        if (!isPlaying) {\n          setHistory(draft => {\n            draft.stateHistory = draft.stateHistory.slice(0, draft.idx + 1);\n          });\n        }\n\n        setIsPlaying(!isPlaying);\n      }}\n    >\n      {isPlaying ? \"❚❚\" : \"▶︎\"}\n    </RoundButton>\n\n    <RoundButton onClick={onReset}>\n      <span style={{ fontSize: 14 }}>◼</span>\n    </RoundButton>\n\n    <div className=\"ml2 w-100\">\n      <Slider\n        disabled={isPlaying}\n        position={\n          stateHistory.length > 1\n            ? Math.max(0, historyIdx / (stateHistory.length - 1))\n            : 0\n        }\n        onChange={v =>\n          setHistory(draft => {\n            draft.idx = clamp(\n              Math.floor(v * stateHistory.length),\n              0,\n              stateHistory.length - 1\n            );\n          })\n        }\n      />\n    </div>\n  </div>\n);\n\nexport const Sketch = ({\n  sketch,\n  constants,\n  code,\n  setConstants,\n  setHighlight\n}) => {\n  const [isPlaying, setIsPlaying] = useState(DEFAULT_IS_PLAYING);\n  const [optimiser, setOptimiser] = useState(false);\n\n  const [\n    { stateHistory, eventsHistory, idx: historyIdx },\n    setHistory\n  ] = useImmer({\n    stateHistory: [sketch.initialState || {}],\n    eventsHistory: [[]],\n    idx: 0\n  });\n\n  const [width, height] = get(sketch, \"size\", [800, 600]);\n  const globals = { width, height };\n\n  useEffect(() => {\n    if (!optimiser) {\n      return;\n    }\n\n    const state = stateHistory[historyIdx];\n\n    const newConstants = optimise({\n      ...optimiser,\n      sketch,\n      state,\n      globals,\n      constants\n    });\n\n    if (newConstants) {\n      setConstants(newConstants);\n    }\n  }, [optimiser]);\n\n  return (\n    <div className=\"w-100 h-100\">\n      <Panel direction={DIRECTION.VERTICAL} defaultDivide={0.85}>\n        <div className=\"flex flex-column h-100\">\n          <div className=\"mb2\">\n            <SketchControls\n              setHistory={setHistory}\n              historyIdx={historyIdx}\n              isPlaying={isPlaying}\n              setIsPlaying={setIsPlaying}\n              stateHistory={stateHistory}\n              onReset={() => {\n                setHistory(draft => {\n                  draft.stateHistory = [sketch.initialState || {}];\n                  draft.eventsHistory = [[]];\n                  draft.idx = 0;\n                });\n\n                setIsPlaying(false);\n              }}\n            />\n          </div>\n\n          <div className=\"flex justify-center items-center relative h-100 overflow-hidden\">\n            <SketchContainer\n              width={width}\n              height={height}\n              sketch={sketch}\n              code={code}\n              isPlaying={isPlaying}\n              historyIdx={historyIdx}\n              stateHistory={stateHistory}\n              eventsHistory={eventsHistory}\n              constants={constants}\n              globals={globals}\n              optimiser={optimiser}\n              setHistory={setHistory}\n              setOptimiser={setOptimiser}\n              setHighlight={setHighlight}\n            />\n          </div>\n        </div>\n\n        <div className=\"pa2 overflow-scroll h-100\">\n          <JSON\n            src={stateHistory[historyIdx]}\n            name=\"state\"\n            enableClipboard={false}\n            displayDataTypes={false}\n            displayObjectSize={false}\n            indentWidth={2}\n            collapsed={1}\n            theme=\"grayscale\"\n          />\n        </div>\n      </Panel>\n    </div>\n  );\n};\n","import { useState } from \"react\";\nimport immer from \"immer\";\n\nexport const useImmer = initialValue => {\n  const [val, updateValue] = useState(initialValue);\n  return [val, updater => updateValue(immer(updater))];\n};\n","import { uncmin } from \"numeric\";\nimport { get } from \"lodash\";\n\nimport { add, dist } from \"./math\";\n\nexport const optimise = ({ constants, sketch, state, id, target, delta }) => {\n  const x0 = constants;\n\n  let minimised;\n\n  try {\n    minimised = uncmin(\n      x => {\n        const drawCalls = sketch.draw(state, x);\n        const pos = get(drawCalls, [id, 1, \"pos\"]);\n\n        if (pos !== undefined) {\n          return dist(add(pos, delta), target);\n        }\n\n        return 0;\n      },\n      x0,\n      0.01,\n      undefined,\n      100\n    );\n  } catch (e) {\n    console.warn(e);\n  }\n\n  if (minimised && minimised.solution) {\n    return minimised.solution;\n  }\n};\n","import React from \"react\";\nimport useWindowSize from \"@rehooks/window-size\";\n\nexport const Overlay = ({ width, height, children, onClose }) => {\n  const { innerWidth, innerHeight } = useWindowSize();\n\n  return (\n    <>\n      <div\n        className=\"absolute absolute--fill\"\n        style={{\n          background: \"rgba(0, 0, 0, 0.5)\",\n          zIndex: 10\n        }}\n        onClick={() => {\n          if (onClose) {\n            onClose();\n          }\n        }}\n      />\n\n      <div\n        className=\"overlfow-scroll absolute bg-custom-dark ba bg-gray\"\n        style={{\n          top: (innerHeight - height) / 2,\n          left: (innerWidth - width) / 2,\n          width,\n          height,\n          zIndex: 20\n        }}\n      >\n        {children}\n      </div>\n    </>\n  );\n};\n","import React from \"react\";\n\nimport { Overlay } from \"./overlay\";\n\nconst A = ({ href, children }) => (\n  <a className=\"light-gray dim\" href={href}>\n    {children}\n  </a>\n);\n\nconst LANG_HELP = [\n  [\"background\", [\"fill\"]],\n  [\"line\", [\"a\", \"b\", \"stroke\"]],\n  [\"path\", [\"points\", \"stroke\", \"fill\"]],\n  [\"ellipse\", [\"pos\", \"size\", \"fill\", \"stroke\"]],\n  [\"rect\", [\"pos\", \"size\", \"fill\", \"stroke\"]]\n];\n\nconst SAMPLE_CODE = `sketch({\n  // sketch size\n  size: [600, 600],\n\n  // starting state\n  initialState: { size: 10 },\n\n  // update state into a new state, called before every draw\n  update: state => {\n    state.size += 10;\n    return state;\n  },\n\n  draw: state => {\n    // return an array of objects to be placed on the sketch\n    return [\n      [\"background\", { fill: \"#fff\" }],\n      [\"ellipse\", {\n        pos: [ 300 ,300 ],\n        size: [ state.size, state.size ]\n      }]\n    ];\n  }\n})\n`;\n\nexport const Help = ({ onClose }) => (\n  <Overlay width={600} height={600} onClose={onClose}>\n    <div className=\"overflow-scroll h-100 pa3\">\n      <div className=\"measure-wide lh-copy f7 light-gray\">\n        <p>\n          <span className=\"gray\">dacein</span> is an experimental IDE and\n          library for creative coding made by{\" \"}\n          <A href=\"https://szymonkaliski.com\">Szymon Kaliski</A>.\n        </p>\n\n        <p>\n          In addition to declarative canvas-based graphics library it provides{\" \"}\n          color and number pickers in editor for{\" \"}\n          <span className=\"i\">live coding</span>,{\" \"}\n          <span className=\"i\">time travel</span> through the sketch updates and{\" \"}\n          <span className=\"i\">direct manipulation</span> from canvas back into\n          code.\n        </p>\n\n        <p>\n          Both <span className=\"i\">time travel</span> and{\" \"}\n          <span className=\"i\">direct manipulation</span> are only available when\n          the sketch is paused.\n        </p>\n\n        <ol className=\"list pl3\">\n          <li style={{ listStyle: \"disc\" }}>\n            to travel through time, use the slider near play/pause buttons\n          </li>\n          <li style={{ listStyle: \"disc\" }}>\n            to manipulte the code, drag an <span className=\"gray\">ellipse</span>{\" \"}\n            or <span className=\"gray\">rect</span>\n          </li>\n        </ol>\n\n        <p>\n          It is heavily inspired by{\" \"}\n          <A href=\"http://processing.org\">Processing</A>,{\" \"}\n          <A href=\"https://github.com/thi-ng/umbrella/tree/master/packages/hdom-canvas\">\n            @thi.ng/hdom-canvas\n          </A>\n          , and numerous other tools.\n        </p>\n\n        <p>\n          The <span className=\"gray\">sketch</span> library is a global function\n          requiring an object with at least a <span className=\"gray\">draw</span>{\" \"}\n          property:\n        </p>\n      </div>\n\n      <div className=\"lh-copy f7 light-gray\">\n        <pre className=\"gray\">{SAMPLE_CODE}</pre>\n      </div>\n\n      <div className=\"measure-wide lh-copy f7 light-gray\">\n        <p>Commands available in the language:</p>\n\n        <ol className=\"list pl3\">\n          {LANG_HELP.map(([command, args]) => (\n            <li key={command} style={{ listStyle: \"disc\" }}>\n              <span className=\"gray\">{command}</span> ({\"{\"}{\" \"}\n              {args.map((arg, i) => (\n                <>\n                  <span className=\"gray\" key={arg}>\n                    {arg}\n                  </span>\n                  {i < args.length - 1 ? \", \" : \"\"}\n                </>\n              ))}{\" \"}\n              {\"}\"}})\n            </li>\n          ))}\n        </ol>\n      </div>\n    </div>\n  </Overlay>\n);\n","import React, { useRef, useState } from \"react\";\nimport { saveAs } from \"file-saver\";\n\nimport { Help } from \"./help\";\nimport { EXAMPLES } from \"./examples\";\n\nexport const Topbar = ({ setCode, code }) => {\n  const [isHelpVisible, setHelpVisible] = useState(false);\n  const [isExamplesMenuVisible, setExamplesMenuVisible] = useState(false);\n\n  const fileRef = useRef(null);\n\n  return (\n    <>\n      <div className=\"bb b--gray flex f7\" style={{ marginBottom: 5 }}>\n        <span className=\"bg-gray custom-dark pv2 ph3 dib mr3\">dacein</span>\n\n        <div className=\"pa2\">\n          <span\n            className=\"dib mr3 pointer dim\"\n            onClick={() => {\n              if (!fileRef.current) {\n                return;\n              }\n\n              fileRef.current.click();\n            }}\n          >\n            open\n          </span>\n          <span\n            className=\"dib mr4 pointer dim\"\n            onClick={() => {\n              saveAs(\n                new Blob([code], {\n                  type: \"text/plain;charset=utf-8\"\n                }),\n                \"sketch.js\"\n              );\n            }}\n          >\n            save\n          </span>\n\n          <div className=\"dib mr3 relative\">\n            <span\n              className=\"pointer dim\"\n              onClick={() => setExamplesMenuVisible(!isExamplesMenuVisible)}\n            >\n              examples\n            </span>\n\n            {isExamplesMenuVisible && (\n              <div\n                className=\"absolute ba b--gray bg-custom-dark pa2 mt2\"\n                style={{ zIndex: 10, left: -10, width: 160 }}\n              >\n                <ol className=\"list pa0 ma0\">\n                  {Object.entries(EXAMPLES).map(([key, exampleCode]) => (\n                    <li\n                      className=\"pa1 dim pointer\"\n                      key={key}\n                      onClick={() => {\n                        setCode(exampleCode);\n                        setExamplesMenuVisible(false);\n                      }}\n                    >\n                      {key}\n                    </li>\n                  ))}\n                </ol>\n              </div>\n            )}\n          </div>\n\n          <span\n            className=\"dib mr3 pointer dim\"\n            onClick={() => setHelpVisible(!isHelpVisible)}\n          >\n            help\n          </span>\n        </div>\n\n        <input\n          type=\"file\"\n          className=\"dn\"\n          ref={fileRef}\n          onChange={e => {\n            const [file] = e.target.files;\n\n            if (!file) {\n              return;\n            }\n\n            const reader = new FileReader();\n\n            reader.onload = e => {\n              const content = e.target.result;\n              setCode(content);\n            };\n\n            reader.readAsText(file);\n          }}\n        />\n      </div>\n\n      {isHelpVisible && <Help onClose={() => setHelpVisible(false)} />}\n    </>\n  );\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport { App } from \"./app\";\n\nconst USE_CREATE_ROOT = false;\n\nif (USE_CREATE_ROOT) {\n  ReactDOM.unstable_createRoot(document.getElementById(\"root\")).render(<App />);\n} else {\n  ReactDOM.render(<App />, document.getElementById(\"root\"));\n}\n","export const COMMANDS = {\n  background: (ctx, { fill }, { width, height }) => {\n    ctx.fillStyle = fill;\n    ctx.fillRect(0, 0, width, height);\n  },\n\n  line: (ctx, { a, b, stroke }) => {\n    if (!stroke) {\n      return;\n    }\n\n    ctx.strokeStyle = stroke;\n\n    ctx.beginPath();\n    ctx.moveTo(a[0], a[1]);\n    ctx.lineTo(b[0], b[1]);\n    ctx.stroke();\n  },\n\n  path: (ctx, { points, stroke, fill }) => {\n    if (stroke) {\n      ctx.strokeStyle = stroke;\n    }\n    if (fill) {\n      ctx.fillStyle = fill;\n    }\n\n    ctx.beginPath();\n    ctx.moveTo(points[0][0], points[0][1]);\n    for (const point of points) {\n      ctx.lineTo(point[0], point[1]);\n    }\n    ctx.stroke();\n\n    if (fill) {\n      ctx.fill();\n    }\n    if (stroke) {\n      ctx.stroke();\n    }\n  },\n\n  ellipse: (ctx, { pos, size, fill, stroke }) => {\n    if (fill) {\n      ctx.fillStyle = fill;\n    }\n    if (stroke) {\n      ctx.strokeStyle = stroke;\n    }\n\n    const [x, y] = pos || [0, 0];\n    const [w, h] = size || [0, 0];\n\n    ctx.beginPath();\n    ctx.ellipse(x, y, w, h, 0, 0, Math.PI * 2);\n\n    if (fill) {\n      ctx.fill();\n    }\n    if (stroke) {\n      ctx.stroke();\n    }\n  },\n\n  rect: (ctx, { pos, size, fill, stroke }) => {\n    if (fill) {\n      ctx.fillStyle = fill;\n    }\n    if (stroke) {\n      ctx.strokeStyle = stroke;\n    }\n\n    const [x, y] = pos || [0, 0];\n    const [w, h] = size || [0, 0];\n\n    ctx.beginPath();\n    ctx.rect(x, y, w, h);\n\n    if (fill) {\n      ctx.fill();\n    }\n    if (stroke) {\n      ctx.stroke();\n    }\n  }\n};\n","import React, { useRef, useState, useEffect } from \"react\";\nimport useComponentSize from \"@rehooks/component-size\";\n\nexport const DIRECTION = {\n  HORIZONTAL: \"HORIZONTAL\",\n  VERTICAL: \"VERTICAL\"\n};\n\nexport const Panel = ({\n  children,\n  direction = DIRECTION.HORIZONTAL,\n  defaultDivide = 0.5\n}) => {\n  const ref = useRef(null);\n  const size = useComponentSize(ref);\n  const [isDragging, setIsDragging] = useState(false);\n  const [divider, setDivider] = useState(defaultDivide);\n\n  useEffect(() => {\n    if (!ref) {\n      return;\n    }\n\n    const bbox = ref.current.getBoundingClientRect();\n\n    const onMouseMove = e => {\n      e.preventDefault();\n\n      if (direction === DIRECTION.HORIZONTAL) {\n        if (e.clientX === 0) {\n          return;\n        }\n\n        setDivider((e.clientX - bbox.left) / size.width);\n      } else {\n        if (e.clientY === 0) {\n          return;\n        }\n\n        setDivider((e.clientY - bbox.top) / size.height);\n      }\n    };\n\n    const onMouseUp = () => {\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n\n      setIsDragging(false);\n    };\n\n    if (isDragging !== false) {\n      window.addEventListener(\"mousemove\", onMouseMove);\n      window.addEventListener(\"mouseup\", onMouseUp);\n    }\n\n    return () => {\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [isDragging, direction, ref]);\n\n  const dividerSize = 10;\n  const handleSize = 1;\n\n  const styles =\n    direction === DIRECTION.HORIZONTAL\n      ? [\n          { width: Math.round(size.width * divider - dividerSize / 2) },\n          { width: Math.round(size.width * (1 - divider) - dividerSize / 2) }\n        ]\n      : [\n          { height: Math.round(size.height * divider - dividerSize / 2) },\n          { height: Math.round(size.height * (1 - divider) - dividerSize / 2) }\n        ];\n\n  const handleWrapperStyle =\n    direction === DIRECTION.HORIZONTAL\n      ? { width: dividerSize, cursor: \"ew-resize\" }\n      : { height: dividerSize, cursor: \"ns-resize\" };\n\n  const handleStyle =\n    direction === DIRECTION.HORIZONTAL\n      ? { width: handleSize, marginLeft: (dividerSize - handleSize) / 2 }\n      : { height: handleSize, marginTop: (dividerSize - handleSize) / 2 };\n\n  const wrapperClassName =\n    direction === DIRECTION.HORIZONTAL ? \"flex\" : \"flex flex-column\";\n\n  return (\n    <div className={`h-100 ${wrapperClassName}`} ref={ref}>\n      <div style={styles[0]} className=\"overflow-hidden\">\n        {children[0]}\n      </div>\n\n      <div\n        className=\"h-100\"\n        onMouseDown={e => {\n          e.preventDefault();\n          setIsDragging(true);\n        }}\n        style={handleWrapperStyle}\n      >\n        <div className=\"h-100 bg-gray\" style={handleStyle} />\n      </div>\n\n      <div style={styles[1]} className=\"overflow-hidden\">\n        {children[1]}\n      </div>\n    </div>\n  );\n};\n","import recast from \"recast\";\nimport types from \"ast-types\";\nimport { get, isNumber } from \"lodash\";\n\nimport { COMMANDS } from \"./commands\";\n\nconst Builders = recast.types.builders;\nconst isCommand = key => COMMANDS[key] !== undefined;\n\nexport const addMeta = code => {\n  const ast = recast.parse(code);\n\n  types.visit(ast, {\n    visitExpressionStatement: function(path) {\n      if (get(path, \"value.expression.callee.name\") === \"sketch\") {\n        this.traverse(path);\n      } else {\n        return false;\n      }\n    },\n\n    visitProperty: function(path) {\n      if (path.value.key.name === \"draw\") {\n        this.traverse(path);\n      } else {\n        return false;\n      }\n    },\n\n    visitReturnStatement: function(path) {\n      this.traverse(path);\n    },\n\n    visitArrayExpression: function(path) {\n      const elements = path.value.elements || [];\n      const maybeCommand = elements[0];\n\n      if (isCommand(get(maybeCommand, \"value\"))) {\n        let loc = maybeCommand.loc;\n        let searchPath = path;\n\n        while (searchPath) {\n          if (\n            get(searchPath, [\"value\", \"body\", \"type\"]) === \"ArrayExpression\" ||\n            get(searchPath, [\"value\", \"type\"]) === \"ArrayExpression\"\n          ) {\n            loc = {\n              start: get(searchPath, [\"value\", \"loc\", \"start\"]),\n              end: get(searchPath, [\"value\", \"loc\", \"end\"])\n            };\n\n            searchPath = undefined;\n          } else {\n            searchPath = get(searchPath, \"parentPath\");\n          }\n        }\n\n        if (elements[1].type === \"ObjectExpression\") {\n          return Builders.arrayExpression([\n            elements[0],\n            Builders.objectExpression([\n              ...elements[1].properties,\n              Builders.property(\n                \"init\",\n                Builders.identifier(\"__meta\"),\n                Builders.objectExpression([\n                  Builders.property(\n                    \"init\",\n                    Builders.identifier(\"lineStart\"),\n                    Builders.literal(loc.start.line)\n                  ),\n                  Builders.property(\n                    \"init\",\n                    Builders.identifier(\"lineEnd\"),\n                    Builders.literal(loc.end.line)\n                  )\n                ])\n              )\n            ])\n          ]);\n        }\n\n        return false;\n      } else {\n        this.traverse(path);\n      }\n    }\n  });\n\n  const { code: finalCode } = recast.print(ast);\n\n  return finalCode;\n};\n\nexport const processRequire = code => {\n  const ast = recast.parse(code);\n\n  const requires = [];\n\n  types.visit(ast, {\n    visitIdentifier: function(path) {\n      if (path.value.name === \"require\") {\n        const arg = path.parentPath.value.arguments[0].value;\n        const name = path.parentPath.parentPath.value.id.name;\n        const loc = path.parentPath.parentPath.parentPath.value[0].loc;\n\n        requires.push({\n          start: loc.start.line - 1,\n          end: loc.end.line - 1,\n          arg,\n          name\n        });\n\n        return false;\n      }\n\n      this.traverse(path);\n    }\n  });\n\n  if (!requires.length) {\n    return code;\n  }\n\n  // TODO: this should be done with recast as well, but I'm lazy\n  const codeWithoutRequire = code\n    .split(\"\\n\")\n    .map((line, i) => {\n      const shouldBeBlank = requires.some(\n        ({ start, end }) => i >= start && i <= end\n      );\n\n      if (shouldBeBlank) {\n        return \"\";\n      }\n\n      return line;\n    })\n    .join(\"\\n\");\n\n  const finalCode = `\n    ${requires\n      .map(({ name, arg }) => `window.require(\"${arg}\").then(${name} => {`)\n      .join(\"\\n\")}\n\n    ${codeWithoutRequire}\n\n    ${requires\n      // TODO: set error from here\n      .map(({ name, arg }) => `}).catch(e => console.warn(e));`)\n      .join(\"\\n\")}\n  `;\n\n  return finalCode;\n};\n\nexport const replaceConstants = (code, constants) => {\n  let idx = 0;\n\n  const ast = recast.parse(code);\n\n  types.visit(ast, {\n    visitLiteral: function(path) {\n      if (isNumber(path.value.value)) {\n        let searchPath = path;\n        let isInsideDraw = false;\n\n        while (searchPath) {\n          if (get(searchPath, [\"value\", \"key\", \"name\"]) === \"draw\") {\n            searchPath = null;\n            isInsideDraw = true;\n          }\n          searchPath = get(searchPath, \"parentPath\");\n        }\n\n        if (!isInsideDraw) {\n          this.traverse(path);\n          return;\n        }\n\n        if (constants && constants[idx]) {\n          const number = constants[idx];\n\n          path.value.value = number;\n          path.value.raw = `${number}`;\n\n          idx++;\n        }\n      }\n\n      this.traverse(path);\n    }\n  });\n\n  return recast.print(ast).code;\n};\n\nexport const pullOutConstants = code => {\n  const ast = recast.parse(code);\n\n  let idx = 0;\n  const pulledConstants = [];\n\n  types.visit(ast, {\n    visitArrowFunctionExpression: function(path) {\n      if (get(path, \"parentPath.value.key.name\") === \"draw\") {\n        return Builders.arrowFunctionExpression(\n          [Builders.identifier(\"state\"), Builders.identifier(\"__constants\")],\n          path.value.body\n        );\n      }\n\n      this.traverse(path);\n    },\n\n    visitFunctionExpression: function(path) {\n      if (get(path, \"parentPath.value.key.name\") === \"draw\") {\n        return Builders.functionExpression(\n          null,\n          [Builders.identifier(\"state\"), Builders.identifier(\"__constants\")],\n          path.value.body\n        );\n      }\n\n      this.traverse(path);\n    },\n\n    visitLiteral: function(path) {\n      if (isNumber(path.value.value)) {\n        // protect from recursively updating in place\n        if (\n          get(path, [\"parentPath\", \"value\", \"object\", \"name\"]) === \"__constants\"\n        ) {\n          return false;\n        }\n\n        let searchPath = path;\n        let isInsideDraw = false;\n\n        while (searchPath) {\n          if (get(searchPath, [\"value\", \"key\", \"name\"]) === \"draw\") {\n            searchPath = null;\n            isInsideDraw = true;\n          }\n          searchPath = get(searchPath, \"parentPath\");\n        }\n\n        if (!isInsideDraw) {\n          this.traverse(path);\n          return;\n        }\n\n        pulledConstants.push(path.value.value);\n\n        return Builders.memberExpression(\n          Builders.identifier(\"__constants\"),\n          Builders.literal(idx++)\n        );\n      }\n\n      this.traverse(path);\n    }\n  });\n\n  return {\n    code: recast.print(ast).code,\n    constants: pulledConstants\n  };\n};\n","export const EXAMPLES = {\n  \"animated rectangle\": `sketch({\n  size: [600, 600],\n\n  initialState: {\n    rectSize: 100,\n    direction: 1\n  },\n\n  update: state => {\n    state.rectSize = state.rectSize + state.direction;\n\n    if (state.rectSize > 220) {\n      state.direction = -1;\n    }\n\n    if (state.rectSize < 20) {\n      state.direction = 1;\n    }\n\n    return state;\n  },\n\n  draw: state => {\n    const pos = [\n      300 - state.rectSize / 2,\n      300 - state.rectSize / 2,\n    ];\n\n    const size = [\n      state.rectSize,\n      state.rectSize\n    ];\n\n    return [\n      [\"background\", { fill: \"#d2d2d2\" }],\n      [\"rect\", { fill: \"#050505\", pos, size }]\n    ];\n  }\n});`,\n\n  \"brownian motion\": `const MAX_STEPS = 1000;\nconst RANGE = 10;\n\nconst rand = (min, max) => Math.random() * (max - min) + min;\n\nsketch({\n  size: [600, 600],\n\n  initialState: {\n    path: [\n      [300, 300]\n    ]\n  },\n\n  update: state => {\n    state.path.push([\n      state.path[state.path.length - 1][0] + rand(-RANGE, RANGE),\n      state.path[state.path.length - 1][1] + rand(-RANGE, RANGE)\n    ]);\n\n    if (state.path.length > MAX_STEPS) {\n      state.path.shift();\n    }\n\n    return state;\n  },\n\n  draw: state => {\n    return [\n      [\"background\", { fill: \"#d2d2d2\" }],\n      ...state.path.slice(1).map((pos, i) => [\n        \"line\",\n        {\n          a: pos,\n          b: state.path[i],\n          stroke: \"#050505\"\n        }\n      ])\n    ]\n  }\n});`,\n\n  events: `sketch({\n  size: [600, 600],\n\n  initialState: {\n    mousePos: [0, 0],\n    mouseClicked: false\n  },\n\n  update: (state, events) => {\n    events.forEach(event => {\n      if (event.source == \"mousemove\") {\n        state.mousePos = event.pos;\n      }\n\n      if (event.source == \"mousedown\") {\n        state.mouseClicked = true;\n      }\n\n      if (event.source == \"mouseup\") {\n        state.mouseClicked = false;\n      }\n    });\n\n    return state;\n  },\n\n  draw: state => {\n    return [\n      [\"background\", { fill: state.mouseClicked ? \"#d2d2d2\" : \"#a2a2a2\" }],\n      [\"line\", {\n        a: state.mousePos,\n        b: [300, 300]\n        stroke: \"#050505\"\n      }]\n    ];\n  }\n});`,\n\n  \"particle system\": `// adapted from https://p5js.org/examples/simulate-particle-system.htmlconst\n\nconst vec2 = require(\"gl-vec2\"); // require works\n\nconst rand = (min, max) => Math.random() * (max - min) + min;\n\nconst makeParticle = position => ({\n  acceleration: [0, 0.05],\n  position: position.slice(0),\n  velocity: [rand(-1, 1), rand(-1, 0)],\n  lifespan: 255\n});\n\nconst updateParticle = particle => {\n  const velocity = vec2.create();\n  const position = vec2.create();\n\n  vec2.add(velocity, particle.velocity, particle.acceleration);\n  vec2.add(position, particle.position, velocity);\n\n  return {\n    lifespan: particle.lifespan - 2,\n    acceleration: particle.acceleration,\n    velocity,\n    position\n  };\n};\n\nconst renderParticle = particle => [\n  \"ellipse\",\n  {\n    pos: particle.position,\n    size: [12, 12],\n    stroke: \\`rgba(255, 255, 255, \\${particle.lifespan})\\`,\n    fill: \\`rgba(127, 127, 127, \\${particle.lifespan})\\`\n  }\n];\n\nsketch({\n  size: [600, 600],\n\n  initialState: {\n    particles: []\n  },\n\n  update: state => {\n    state.particles.push(makeParticle([300, 50]));\n\n    for (let i = state.particles.length - 1; i >= 0; i--) {\n      state.particles[i] = updateParticle(state.particles[i]);\n\n      if (state.particles[i].lifespan < 0) {\n        state.particles.splice(i, 1);\n      }\n    }\n\n    return state;\n  },\n\n  draw: state => {\n    return [\n      [\"background\", { fill: \"#333333\" }],\n      ...state.particles.map(renderParticle)\n    ];\n  }\n});`,\n\n  spring: `\nconst clamp = (v, min, max) => Math.max(min, Math.min(v, max));\n\nconst MIN_HEIGHT = 100;\nconst MAX_HEIGHT = 200;\n\nconst M = 0.8; // mass\nconst K = 0.2; // spring constant\nconst D = 0.92; // damping\nconst R = 150; // rest position\n\nconst updateSpring = spring => {\n  const f = -K * (spring.ps - R); // f=-ky\n  const as = f / M; // set the acceleration, f=ma == a=f/m\n  let vs = D * (spring.vs + as); // set the velocity\n  const ps = spring.ps + vs; // updated position\n\n  if (Math.abs(vs) < 0.1) {\n    vs = 0.0;\n  }\n\n  return Object.assign(spring, { f, as, vs, ps });\n};\n\nsketch({\n  size: [710, 400],\n\n  initialState: {\n    spring: {\n      left: 710 / 2 - 100,\n      width: 200,\n      height: 50,\n      ps: R, // position\n      vs: 0, // velocity\n      as: 0, // acceleration\n      f: 0 // force\n    },\n    mousePos: [0, 0],\n    isOver: false,\n    isDragging: false\n  },\n\n  update: (state, events) => {\n    if (!state.isDragging) {\n      state.spring = updateSpring(state.spring);\n    }\n\n    events.forEach(e => {\n      if (e.source === \"mousemove\") {\n        state.mousePos = e.pos;\n      }\n\n      if (e.source === \"mousedown\") {\n        state.isDragging = true;\n      }\n\n      if (e.source === \"mouseup\") {\n        state.isDragging = false;\n      }\n    });\n\n    if (\n      state.mousePos[0] > state.spring.left &&\n      state.mousePos[0] < state.spring.left + state.spring.width &&\n      state.mousePos[1] > state.spring.ps &&\n      state.mousePos[1] < state.spring.ps + state.spring.height\n    ) {\n      state.isOver = true;\n    } else {\n      state.isOver = false;\n    }\n\n    if (state.isDragging) {\n      state.spring.ps = state.mousePos[1] - state.spring.height / 2;\n      state.spring.ps = clamp(state.spring.ps, MIN_HEIGHT, MAX_HEIGHT);\n    }\n  },\n\n  draw: state => {\n    return [\n      [\"background\", { fill: \"#656565\" }],\n      [\n        \"rect\",\n        {\n          pos: [state.spring.left, state.spring.ps],\n          size: [state.spring.width, state.spring.height],\n          fill: state.isOver ? \"#ffffff\" : \"#cccccc\"\n        }\n      ]\n    ];\n  }\n});\n`\n};\n","import React, { useEffect, useState, useRef } from \"react\";\nimport useComponentSize from \"@rehooks/component-size\";\n\nimport { clamp, scale } from \"./math\";\n\nexport const Slider = ({\n  disabled = false,\n  position = 0.0,\n  onChange = () => {},\n  height = 10\n}) => {\n  const ref = useRef(null);\n  const bbox = useRef(null);\n  const size = useComponentSize(ref);\n  const [isDragging, setIsDragging] = useState(false);\n\n  useEffect(() => {\n    if (!ref) {\n      return;\n    }\n\n    if (disabled) {\n      return;\n    }\n\n    bbox.current = ref.current.getBoundingClientRect();\n\n    const onMouseMove = e => {\n      e.preventDefault();\n\n      if (e.clientX === 0) {\n        return;\n      }\n\n      const value = (e.clientX - bbox.current.left) / size.width;\n      onChange(clamp(value, 0, 1));\n    };\n\n    const onMouseUp = () => {\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n\n      setIsDragging(false);\n    };\n\n    if (isDragging !== false) {\n      window.addEventListener(\"mousemove\", onMouseMove);\n      window.addEventListener(\"mouseup\", onMouseUp);\n    }\n\n    return () => {\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  });\n\n  const left = clamp(\n    scale(position, 0, 1, 2, size.width - 1 - height),\n    2,\n    size.width - 1 - height\n  );\n\n  return (\n    <div\n      ref={ref}\n      className=\"w-100 bg-gray relative br3\"\n      style={{ height }}\n      onClick={e => {\n        const value = (e.clientX - bbox.current.left) / size.width;\n        onChange(clamp(value, 0, 1));\n      }}\n    >\n      <div\n        className=\"bg-custom-dark br-pill absolute dim\"\n        style={{\n          height: height - 2,\n          width: height - 2,\n          top: 1,\n          left: `${left}px`,\n          cursor: \"ew-resize\"\n        }}\n        onMouseDown={e => {\n          e.preventDefault();\n          setIsDragging(true);\n        }}\n      />\n    </div>\n  );\n};\n","export const clamp = (v, min, max) => Math.max(min, Math.min(v, max));\n\nexport const scale = (val, inputMin, inputMax, outputMin, outputMax) => {\n  return (\n    (outputMax - outputMin) * ((val - inputMin) / (inputMax - inputMin)) +\n    outputMin\n  );\n};\n\nexport const dist = ([ax, ay], [bx, by]) => Math.hypot(bx - ax, by - ay);\n\nexport const add = ([ax, ay], [bx, by]) => [ax + bx, ay + by];\n","import React, { useEffect, useState } from \"react\";\nimport { requireFrom } from \"d3-require\";\n\nimport { EXAMPLES } from \"./examples\";\nimport { Editor } from \"./editor\";\nimport { Errors } from \"./errors\";\nimport { Panel, DIRECTION } from \"./panel\";\nimport { Sketch } from \"./sketch\";\nimport { Topbar } from \"./topbar\";\n\nimport {\n  addMeta,\n  processRequire,\n  pullOutConstants,\n  replaceConstants\n} from \"./ast-transforms\";\n\nimport \"tachyons\";\nimport \"./style.css\";\n\nexport const App = () => {\n  const [code, setCode] = useState(EXAMPLES[\"animated rectangle\"]);\n  const [constants, setConstants] = useState(null);\n  const [sketch, setSketch] = useState(null);\n  const [errors, setErrors] = useState(null);\n  const [highlight, setHighlight] = useState(null);\n\n  useEffect(() => {\n    let tmpErrors = [];\n    let pulledConstants = null;\n    let finalCode = null;\n\n    window.require = requireFrom(name =>\n      Promise.resolve(`https://bundle.run/${name}`)\n    );\n\n    window.sketch = sketch => {\n      try {\n        if (sketch.update) {\n          sketch.update(sketch.initialState || {}, []);\n        }\n\n        if (sketch.draw) {\n          sketch.draw(sketch.initialState || {}, pulledConstants || []);\n        }\n      } catch (e) {\n        console.warn(e);\n        tmpErrors.push(e.description);\n      }\n\n      if (tmpErrors.length > 0) {\n        setErrors(tmpErrors);\n      } else {\n        setSketch({\n          initialState: {},\n          update: () => {},\n          draw: () => [],\n          ...sketch\n        });\n      }\n    };\n\n    // ast\n    try {\n      const {\n        code: codeWithoutConstants,\n        constants: pulledOutConstants\n      } = pullOutConstants(code);\n\n      const codeWithMeta = addMeta(codeWithoutConstants);\n      const codeWithRequires = processRequire(codeWithMeta);\n\n      pulledConstants = pulledOutConstants;\n      finalCode = codeWithRequires;\n    } catch (e) {\n      console.warn(e);\n      tmpErrors.push(e.description);\n    }\n\n    if (pulledConstants) {\n      setConstants(pulledConstants);\n    }\n\n    // eval only if we have something worth evaling\n    if (finalCode) {\n      try {\n        eval(`\n            const sketch = window.sketch;\n            ${finalCode}\n          `);\n      } catch (e) {\n        console.warn(e);\n        tmpErrors.push(e.description);\n      }\n    }\n\n    setErrors(tmpErrors);\n\n    return () => {\n      delete window.sketch;\n      delete window.require;\n    };\n  }, [code]);\n\n  return (\n    <div className=\"code vh-100 bg-custom-dark near-white flex flex-column\">\n      <div>\n        <Topbar setCode={setCode} code={code} />\n      </div>\n\n      <Panel>\n        <div className=\"h-100\">\n          {sketch && (\n            <Sketch\n              sketch={sketch}\n              code={code}\n              constants={constants}\n              setConstants={newConstants =>\n                setCode(replaceConstants(code, newConstants))\n              }\n              setHighlight={setHighlight}\n            />\n          )}\n        </div>\n\n        <div className=\"h-100\">\n          <Panel direction={DIRECTION.VERTICAL} defaultDivide={0.85}>\n            <Editor\n              code={code}\n              onChange={e => setCode(e)}\n              highlight={highlight}\n            />\n\n            <div>\n              <Errors errors={errors} />\n            </div>\n          </Panel>\n        </div>\n      </Panel>\n    </div>\n  );\n};\n"],"sourceRoot":""}